<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ğŸ“ My Blog</h1>
            <div class="nav-links">
                {% if username %}
                    <span class="welcome">Welcome, <strong>{{ username }}</strong>!</span>
                    <a href="{{ url_for('create_post') }}" class="btn btn-primary">âœï¸ Create Post</a>
                    <a href="{{ url_for('logout') }}" class="btn btn-secondary">ğŸšª Logout</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn btn-primary">ğŸ” Login</a>
                    <a href="{{ url_for('signup') }}" class="btn btn-secondary">ğŸ“ Sign Up</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Flash Messages -->
        {% if success_msg %}
            <div class="flash-message flash-success">
                {{ success_msg }}
            </div>
        {% endif %}

        {% if error_msg %}
            <div class="flash-message flash-error">
                {{ error_msg }}
            </div>
        {% endif %}

        <div class="posts-section">
            <h2>ğŸ“° Recent Posts</h2>
            
            {% if posts %}
                <div class="posts-grid">
                    {% for post in posts %}
                        <article class="post-card">
                            <div class="post-header">
                                <h3>{{ post.title }}</h3>
                                <span class="post-meta">
                                    ğŸ‘¤ by <strong>{{ post.username }}</strong> â€¢ 
                                    ğŸ• {{ post.timestamp.strftime('%B %d, %Y at %I:%M %p') }}
                                </span>
                            </div>

                            {% if post.image %}
                                <div class="post-image">
                                    <img src="data:image/{{ post.image_type }};base64,{{ post.image }}" 
                                         alt="{{ post.title }}"
                                         class="post-img-clickable"
                                         onclick="openImageModal(this)"
                                         title="Click to enlarge">
                                    <div class="image-zoom-hint">ğŸ” Click to enlarge</div>
                                </div>
                            {% endif %}

                            <div class="post-content">
                                {{ post.content }}
                            </div>

                            {% if post.is_owner %}
                                <div class="post-actions">
                                    <a href="{{ url_for('edit_post', post_id=post._id) }}" class="btn btn-primary btn-sm">
                                        âœï¸ Edit
                                    </a>
                                    <a href="{{ url_for('delete_post', post_id=post._id) }}" 
                                       class="btn btn-danger btn-sm delete-btn"
                                       onclick="return confirm('âš ï¸ Are you sure you want to delete this post? This cannot be undone!')">
                                        ğŸ—‘ï¸ Delete
                                    </a>
                                </div>
                            {% endif %}
                        </article>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>ğŸ“­ No posts yet. Be the first to create one!</p>
                    {% if username %}
                        <a href="{{ url_for('create_post') }}" class="btn btn-primary">âœï¸ Create First Post</a>
                    {% else %}
                        <a href="{{ url_for('signup') }}" class="btn btn-primary">ğŸ“ Sign Up to Post</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Image Modal/Lightbox -->
    <div id="imageModal" class="image-modal">
        <span class="modal-close" onclick="closeImageModal()">&times;</span>
        <div class="modal-content-wrapper">
            <img class="modal-content" id="modalImage">
            <div class="modal-caption" id="modalCaption"></div>
        </div>
        <button class="modal-nav modal-prev" onclick="navigateImage(-1)">â®</button>
        <button class="modal-nav modal-next" onclick="navigateImage(1)">â¯</button>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2026 Anomoyous blog uploder. ( Made by Aashish Jha Production )</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>